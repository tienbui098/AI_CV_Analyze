@model AI_CV_Analyze.Models.JobSuggestionRequest

@{
    ViewData["Title"] = "Job Prediction";
    Layout = "_LayoutJobPrediction";
}

<div class="job-prediction-container">
    <div class="container">
        <a href="@Url.Action("AnalysisResult", "CVAnalysis")" class="back-button">
            <i class="fas fa-arrow-left"></i>Quay lại kết quả phân tích
        </a>
        
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="job-prediction-card shadow">
                    <div class="card-header">
                        <h2><i class="fas fa-briefcase me-2"></i>Dự đoán công việc phù hợp</h2>
                    </div>
                    <div class="card-body p-4">
                        <form asp-action="JobPrediction" method="post" id="jobPredictionForm">
                            <div class="mb-4">
                                <label for="Skills" class="form-label">
                                    <i class="fas fa-code me-2"></i>Nhập kỹ năng của bạn (phân cách bằng dấu phẩy):
                                </label>
                                <div class="skills-input-container">
                                    <textarea asp-for="Skills" class="form-control" rows="4" 
                                              placeholder="Ví dụ: C#, JavaScript, HTML, CSS, React, Node.js, SQL, Git, Docker, AWS"
                                              id="Skills"></textarea>
                                </div>
                                <div class="skills-hint">
                                    <i class="fas fa-lightbulb me-1"></i>
                                    Nhập các kỹ năng kỹ thuật, ngôn ngữ lập trình, framework và công cụ bạn thành thạo.
                                </div>
                            </div>
                            
                            <input type="hidden" asp-for="JobCategory" />
                            
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-search me-2"></i>Tìm kiếm công việc phù hợp
                                </button>
                            </div>
                        </form>

                        @if (!string.IsNullOrEmpty(ViewBag.ErrorMessage))
                        {
                            <div class="alert alert-danger mt-4">
                                <i class="fas fa-exclamation-triangle me-2"></i>@ViewBag.ErrorMessage
                            </div>
                        }
                        else if (ViewBag.Results is Dictionary<string, double> results && results.Any())
                        {
                            <div class="results-section">
                                <div class="results-header">
                                    <i class="fas fa-chart-line"></i>
                                    <span>Top công việc phù hợp nhất</span>
                                </div>
                                
                                <div class="row">
                                    @foreach (var item in results.OrderByDescending(x => x.Value).Take(3))
                                    {
                                        <div class="col-md-4 mb-3">
                                            <div class="job-recommendation-card h-100">
                                                <div class="card-body">
                                                    <div class="circular-chart mb-3">
                                                        <svg viewBox="0 0 36 36" class="circular-chart-svg">
                                                            <path class="circle-bg"
                                                                  d="M18 2.0845
                                                                     a 15.9155 15.9155 0 0 1 0 31.831
                                                                     a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                                            <path class="circle"
                                                                  stroke-dasharray="@((item.Value * 100).ToString("0")), 100"
                                                                  d="M18 2.0845
                                                                     a 15.9155 15.9155 0 0 1 0 31.831
                                                                     a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                                            <text x="18" y="20.35" class="percentage" text-anchor="middle" font-size="8">
                                                                @((item.Value * 100).ToString("0"))%
                                                            </text>
                                                        </svg>
                                                    </div>
                                                    <h5 class="card-title">@item.Key</h5>
                                                    <div class="match-percentage">
                                                        <span class="badge bg-success">@((item.Value * 100).ToString("F1"))% phù hợp</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                                
                                @if (results.Count > 3)
                                {
                                    <div class="mt-4">
                                        <h5 class="text-muted mb-3">
                                            <i class="fas fa-list me-2"></i>Các công việc khác
                                        </h5>
                                        <div class="row">
                                            @foreach (var item in results.OrderByDescending(x => x.Value).Skip(3).Take(6))
                                            {
                                                <div class="col-md-6 col-lg-4 mb-2">
                                                    <div class="d-flex align-items-center p-2 border rounded">
                                                        <div class="flex-grow-1">
                                                            <div class="fw-semibold">@item.Key</div>
                                                            <small class="text-muted">@((item.Value * 100).ToString("F1"))% phù hợp</small>
                                                        </div>
                                                        <div class="ms-2">
                                                            <div class="progress" style="width: 60px; height: 6px;">
                                                                <div class="progress-bar bg-success" 
                                                                     style="width: @((item.Value * 100).ToString("0"))%"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                }
                                
                                <div class="mt-4 p-3 bg-light rounded">
                                    <h6 class="text-primary mb-2">
                                        <i class="fas fa-info-circle me-2"></i>Lưu ý
                                    </h6>
                                    <p class="mb-2 small">
                                        Kết quả dựa trên phân tích kỹ năng và yêu cầu công việc. 
                                        Để có kết quả chính xác hơn, hãy cập nhật thêm kỹ năng và kinh nghiệm của bạn.
                                    </p>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-sm btn-outline-primary" onclick="window.print()">
                                            <i class="fas fa-print me-1"></i>In kết quả
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary" onclick="shareResults()">
                                            <i class="fas fa-share me-1"></i>Chia sẻ
                                        </button>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4">
                <div class="job-prediction-card shadow">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Gợi ý</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <h6 class="text-primary">Kỹ năng phổ biến:</h6>
                            <div class="d-flex flex-wrap gap-1">
                                <span class="badge bg-light text-dark">JavaScript</span>
                                <span class="badge bg-light text-dark">Python</span>
                                <span class="badge bg-light text-dark">React</span>
                                <span class="badge bg-light text-dark">Node.js</span>
                                <span class="badge bg-light text-dark">SQL</span>
                                <span class="badge bg-light text-dark">Git</span>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <h6 class="text-primary">Công việc hot:</h6>
                            <ul class="list-unstyled small">
                                <li><i class="fas fa-check text-success me-2"></i>Frontend Developer</li>
                                <li><i class="fas fa-check text-success me-2"></i>Backend Developer</li>
                                <li><i class="fas fa-check text-success me-2"></i>Full Stack Developer</li>
                                <li><i class="fas fa-check text-success me-2"></i>DevOps Engineer</li>
                            </ul>
                        </div>
                        
                        <div class="alert alert-info small">
                            <i class="fas fa-tip me-2"></i>
                            <strong>Mẹo:</strong> Càng nhiều kỹ năng liên quan, kết quả càng chính xác!
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>